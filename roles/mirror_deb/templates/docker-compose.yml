---
version: "2.4"

volumes:
  homeroot:

networks:
  traefik_proxy:
    external: true

services:
  app:
    build: "./"
    image: "{{ docker_apps_image_mirror_deb }}"
    restart: unless-stopped
    logging:
      driver: journald
      options:
        tag: "mirror_deb"
    networks:
      - traefik_proxy
    mem_limit: 128M
    environment:
      TZ: "America/New_York"
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "homeroot:/root"
      - "./extras:/var/www/html/extras"
      - "./keys:/var/www/html/keys"
      - "./mirrors:/var/www/html/mirrors"
    labels:
      traefik.enable: "true"
      traefik.docker.network: "traefik_proxy"
      traefik.http.routers.mirror_deb.entrypoints: "http, https"
      traefik.http.routers.mirror_deb.rule: "Host(`{{ traefik_address_mirror_deb }}`)"
{% if docker_apps_traefik_tls %}
      traefik.http.routers.mirror_deb.tls: "true"
{% endif %}
{% if docker_apps_traefik_tls and docker_apps_traefik_certresolver != "none" %}
      traefik.http.routers.mirror_deb.tls.certresolver: "{{ docker_apps_traefik_certresolver }}"
      traefik.http.routers.mirror_deb.tls.domains[0].main: "{{ traefik_address_mirror_deb }}"
{% endif %}
