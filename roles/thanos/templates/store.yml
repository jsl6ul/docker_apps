{% if store is defined %}
{{ store.name }}-set-volume-owner:
  image: docker.io/alpine
  volumes:
    {{ store.volumes | to_nice_yaml | indent(4) }}
  # Set store volume owner to 'thanos'
  command: sh -c "chown 1001:1001 /data || exit 1"
  user: "root"
  restart: "no"

{{ store.name }}:
  image: "{{ dapp_thanos_docker_image }}"
  container_name: {{ store.name }}
  restart: unless-stopped
  logging:
    driver: journald
    options:
      tag: "{{ store.name }}"
  networks:
    - traefik_proxy
  expose:
    {{ store.expose | to_nice_yaml | indent(4) }}
{% if store.ports is defined %}
  ports:
    {{ store.ports | to_nice_yaml | indent(4) }}
{% endif %}
  environment:
    {{ dapp_thanos_environment | indent(6) }}
  volumes:
    {{ store.volumes | to_nice_yaml | indent(4) }}
  command:
    {{ store.command | to_nice_yaml | indent(4) }}
  depends_on:
    {{ store.name }}-set-volume-owner:
      condition: service_completed_successfully
  labels:
    traefik.enable: "false"
{% endif %}
